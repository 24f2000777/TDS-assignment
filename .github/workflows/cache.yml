# .github/workflows/cache.yml
name: CI with cache

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  cache-job:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Prepare cache dir
        run: |
          mkdir -p .ci-cache/demo
          echo "seed-$(date +%s)" > .ci-cache/demo/seed.txt

      # IMPORTANT: id must be "deps-cache" so we can read outputs below
      - name: Cache demo dir
        id: deps-cache
        uses: actions/cache@v4
        with:
          path: .ci-cache
          key: cache-7799caf

      # IMPORTANT: name must be EXACTLY prime-cache-7799caf
      - name: prime-cache-7799caf
        run: echo "cache-hit: ${{ steps.deps-cache.outputs.cache-hit }}"

      - name: Finish
        run: |
          echo "Cached files:"
          ls -la .ci-cache || true
